# RecommendModel_withFastAPI

## 개요

이 프로젝트는 사용자의 취향, 시청 시간, 예산 등 다양한 조건을 반영해서 최적의 OTT(온라인 동영상 서비스) 구독 플랜과 콘텐츠를 추천해주는 시스템이다. FastAPI 기반 REST API로 `/ott_recommend` 엔드포인트를 제공함.

---

## 주요 API

### `/ott_recommend` (POST)

-   사용자의 선호 장르, 세부 장르, 연령대, 성별, 주간 시청 시간, 월 예산을 입력받아, 추천 콘텐츠와 각 OTT별 최적 구독 플랜을 반환함.
-   **입력 파라미터:**
    -   `base_genres`: List[str] — 기본 장르(예: 영화, 드라마, 예능 등)
    -   `detail_genres`: List[str] — 세부 장르(예: 스릴러, 로맨스 등)
    -   `age_group`: str — 연령대(10대, 20대, ...)
    -   `gender`: str — 성별(m, f)
    -   `weekly_hours`: float — 주간 시청 시간(시간)
    -   `budget`: float — 월 예산(원)
-   **출력:**
    -   추천 콘텐츠 리스트
    -   추천 OTT 구독 플랜(플랫폼명, 요금제명, 가격, 해당 요금제로 커버 가능한 콘텐츠 개수)

---

## 동작 과정 상세 설명

### 1. 입력 데이터 전처리 및 임베딩

-   **SentenceTransformer 라이브러리**
    -   `sentence-transformers`는 BERT 기반의 문장 임베딩 라이브러리임. 다양한 언어의 문장/문구를 고차원 벡터로 변환해줌.
    -   여기서는 `paraphrase-multilingual-MiniLM-L12-v2` 모델을 써서, 장르/세부장르 등 텍스트 정보를 임베딩(숫자 벡터화)함.
-   **임베딩 방식**
    -   모든 고유 장르/세부장르에 대해 임베딩을 미리 계산해서 캐시에 저장함.
    -   각 콘텐츠의 장르 조합도 임베딩 벡터로 변환해서, 유사도 계산에 활용함.

### 2. 유사도 계산 및 점수 산정

-   **장르 유사도**
    -   사용자가 입력한 선호 장르/세부장르와 각 콘텐츠의 장르 임베딩 간 코사인 유사도를 계산함.
    -   여러 장르가 있을 경우, 임베딩 벡터의 평균을 사용해서 유사도를 산출함.
-   **연령/성별 유사도**
    -   사용자의 연령대/성별과 콘텐츠의 타겟 연령/성별이 일치하는지 여부로 점수를 부여함.
-   **최종 점수**
    -   장르 유사도, 연령/성별 유사도, 콘텐츠 자체 점수, 러닝타임 등을 가중합해서 최종 추천 점수를 산출함.

### 3. 추천 콘텐츠 선정

-   점수 내림차순으로 콘텐츠를 정렬한 뒤, 사용자의 월간 시청 시간 내에서 최대한 많은 콘텐츠를 추천함.
-   최소/최대 추천 개수(예: 3~8개) 기준을 적용함.

### 4. OTT 구독 플랜 후보 생성 및 필터링

-   추천된 콘텐츠에 등장하는 모든 OTT(플랫폼)를 추출함.
-   각 OTT별로 예산(월 예산) 이하의 모든 요금제를 후보로 만듦.
-   Greedy 알고리즘으로, 실제로 새롭게 커버할 수 있는 콘텐츠가 1개 이상인 OTT만 최종 선정함.
-   선정된 OTT에 한해서, 예산 내 모든 요금제(cover_count=해당 요금제로 커버 가능한 콘텐츠 수)를 리스트로 반환함.
-   리스트는 커버 가능한 콘텐츠 개수 내림차순으로 정렬됨.

#### 예시

예를 들어, 추천 콘텐츠에 넷플릭스와 티빙이 등장했고, 예산이 12,000원이라고 가정하면:

| 플랫폼   | 요금제   | 가격   | 커버 콘텐츠 수 |
| -------- | -------- | ------ | -------------- |
| 넷플릭스 | 스탠다드 | 9,900  | 3              |
| 티빙     | 베이직   | 7,900  | 2              |
| 티빙     | 스탠다드 | 10,900 | 2              |

이렇게 예산 내 요금제만 리스트에 포함되고, 각 요금제가 실제로 커버할 수 있는 콘텐츠 개수도 함께 보여줌. 또한 티빙에서 볼 수 있는 콘텐츠를 넷플릭스에서도 볼 수 있다면 다음과 같이 넷플릭스만 출력하게 됨.

| 플랫폼   | 요금제   | 가격  | 커버 콘텐츠 수 |
| -------- | -------- | ----- | -------------- |
| 넷플릭스 | 스탠다드 | 9,900 | 3              |

### 5. 반환값

-   추천 콘텐츠 리스트(제목, 플랫폼, 장르, 예상 시청 시간, 점수 등)
-   추천 OTT 구독 플랜(플랫폼명, 요금제명, 가격, 커버 콘텐츠 개수)

## 예시 요청/응답

**요청 예시**

```json
POST /ott_recommend
{
  "base_genres": ["영화", "예능"],
  "detail_genres": ["스릴러", "코미디"],
  "age_group": "20대",
  "gender": "m",
  "weekly_hours": 10,
  "budget": 12000
}
```

**응답 예시**

```json
{
  "status": "success",
  "recommendations": [
    {"title": "콘텐츠A", "platform": "넷플릭스", ...},
    {"title": "콘텐츠B", "platform": "티빙", ...}
  ],
  "subscription_plan": {
    "넷플릭스|스탠다드": {"platform": "넷플릭스", "plan_name": "스탠다드", "price": 9900, "cover_count": 3},
    "티빙|베이직": {"platform": "티빙", "plan_name": "베이직", "price": 7900, "cover_count": 2}
  }
}
```

## 주요 라이브러리 및 기술 스택

-   **FastAPI**: Python 기반 고성능 REST API 서버
-   **Pandas**: 데이터프레임 기반 데이터 처리
-   **SentenceTransformer**: 텍스트 임베딩 및 유사도 계산
-   **scikit-learn**: 코사인 유사도 등 벡터 연산
